[refactor] update code and tests to use async/await